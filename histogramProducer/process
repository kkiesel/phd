#!/bin/bash -e

infiles=(
  /user/kiesel/nTuples/V02/TTJets_V02_nTuple.root
  /user/kiesel/nTuples/V02/QCD_HT300to500_V02_nTuple.root
  /user/kiesel/nTuples/V02/QCD_HT500to700_V02_nTuple.root
  /user/kiesel/nTuples/V02/QCD_HT700to1000_V02_nTuple.root
  /user/kiesel/nTuples/V02/QCD_HT1000to1500_V02_nTuple.root
  /user/kiesel/nTuples/V02/QCD_HT1500to2000_V02_nTuple.root
  /user/kiesel/nTuples/V02/QCD_HT2000toInf_V02_nTuple.root
  /user/kiesel/nTuples/V02/GJets_HT-400To600_V02_nTuple.root
  /user/kiesel/nTuples/V02/GJets_HT-600ToInf_V02_nTuple.root
  /user/kiesel/nTuples/V02/WJetsToLNu_HT-400To600_V02_nTuple.root
  /user/kiesel/nTuples/V02/WJetsToLNu_HT-600ToInf_V02_nTuple.root
  /user/kiesel/nTuples/V02/TTGJets_V02_nTuple.root
  /user/kiesel/nTuples/V02/DYJetsToLL_M-50_V02_nTuple.root
  /user/kiesel/nTuples/V02/JetHT_V02_nTuple.root
  /user/kiesel/nTuples/V02/SinglePhoton_V02_nTuple.root
  /user/kiesel/nTuples/V02/WGToLNuG_V02_nTuple.root
)


# run with no input file first, to compile all versions
root -b -l -q run.C\(\"0\"\)

nCores=5

while [ ${#infiles[@]} -ne 0 ]; do
  sleep 1

  # find out how many root processer are running
  nProcRunning=$(ps hu -C "root -b -l -q run.C"|wc -l)
  if [ "$nProcRunning" -lt "$nCores" ]; then
    root -b -l -q run.C\(\"${infiles[0]}\"\) &
    infiles=( ${infiles[@]:1:99} )
  fi

done

